<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="HodgePotentialHumanFlow">
<title>Potential of Human flow (complete graph case) â€¢ HodgePotentialHumanFlow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Potential of Human flow (complete graph case)">
<meta property="og:description" content="HodgePotentialHumanFlow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">HodgePotentialHumanFlow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PotentialInLondon.html">Potential of Human flow (complete graph case)</a>
    <a class="dropdown-item" href="../articles/PotentialInTokyo.html">Potential of Human flow (general graph case)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Potential of Human flow (complete graph case)</h1>
            
      
      
      <div class="d-none name"><code>PotentialInLondon.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">HodgePotentialHumanFlow</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette shows the scalar potential of a commuting flow in
London.</p>
</div>
<div class="section level2">
<h2 id="dataset-origin-destination-matrix-in-london">Dataset: origin-destination matrix in London<a class="anchor" aria-label="anchor" href="#dataset-origin-destination-matrix-in-london"></a>
</h2>
<p>We use a trip dataset from home to workplace in 2011 obtained from <a href="http://www.nomisweb.co.uk/census/2011/wu03EW" class="external-link">UK Data Service</a>.
The OD matrix denotes the number of commuters aggregated by the middle
layer super output area (MSOA) in the 2011 census. The dataset covers
the MSOAs in England and Wales. Here, we selected the trips only among
MSOAs in Greater London.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"london.csv"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span></span>
<span><span class="co">#&gt;      origin      dest trips</span></span>
<span><span class="co">#&gt; 1 E02000001 E02000001  1506</span></span>
<span><span class="co">#&gt; 2 E02000001 E02000014     2</span></span>
<span><span class="co">#&gt; 3 E02000001 E02000016     3</span></span>
<span><span class="co">#&gt; 4 E02000001 E02000025     1</span></span>
<span><span class="co">#&gt; 5 E02000001 E02000028     1</span></span>
<span><span class="co">#&gt; 6 E02000001 E02000051     1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hodge-kodaira-decomposition">Hodge-Kodaira decomposition<a class="anchor" aria-label="anchor" href="#hodge-kodaira-decomposition"></a>
</h2>
<p>Here, we apply Hodge-Kodaira decomposition, in which human flow is
uniquely decomposed into a potential-driven (gradient) flow and a curl
flow (see our paper for details).</p>
<p>First, we consider the net flow of movement from a given OD matrix
<span class="math inline">\(M\)</span>: <span class="math display">\[
  A = M - M^{\intercal}, \label{eq:netflow}
\]</span> where <span class="math inline">\(M^{\intercal}\)</span>
denotes the transpose of <span class="math inline">\(M\)</span>. Matrix
<span class="math inline">\(A\)</span> is skew-symmetric, that is, <span class="math inline">\(A_{ij} = - A_{ji}\)</span>, and is possibly
described by combinatorial gradient of a potential <span class="math inline">\(s\)</span>, given by <span class="math display">\[
  (\text{grad}\, s)(i, j) =  s_j-s_i.
\]</span></p>
<p>Then, we define an optimization problem for potential <span class="math inline">\(s\)</span>: <span class="math display">\[\begin{equation}
  \min_s  \lVert   \text{grad}\ s - A \rVert_2 = \min_s \left[
\sum_{i,j} \left[ (s_j - s_i) - A_{ij} \right]^2 \right].
\label{eq:optimization_problem}
\end{equation}\]</span> According to the combinatorial Hodge theory, the
space of net flow <span class="math inline">\(\mathcal{A}\)</span> is
orthogonally decomposed into two subspaces: <span class="math display">\[\begin{equation}
  \mathcal{A}  = \text{im}(\text{grad})  \oplus
\text{im}(\text{curl}^*),
\end{equation}\]</span> where <span class="math inline">\(\text{curl}\)</span> is the combinatorial curl
operator and <span class="math inline">\(\text{curl}^*\)</span> is its
adjoint operator. Thus, the optimization problem is equivalent to an
<span class="math inline">\(l_2\)</span>-projection of <span class="math inline">\(A\)</span> onto im(grad), and the minimal norm
solution is given by <span class="math display">\[\begin{equation}
  s_i = -\frac{1}{N} \text{div} A = - \frac{1}{N} \sum_{j=1}^N A_{ij},
\label{eq:potential}
\end{equation}\]</span> where <span class="math inline">\(s_i\)</span>
is the potential at the <span class="math inline">\(i\)</span>th
location and <span class="math inline">\(N\)</span> is the number of
locations. It is noted that <span class="math inline">\(s_i\)</span> is
negative potential (<span class="math inline">\(s_i=-V_i\)</span>). This
means we observe more trips from a place with lower potential to another
with higher potential.</p>
<p>Using this package, the potential is obtained by the following
function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">=</span> <span class="fu">HodgePotentialHumanFlow</span><span class="fu">::</span><span class="fu"><a href="../reference/scalar_potential_on_complete_graph.html">scalar_potential_on_complete_graph</a></span><span class="op">(</span><span class="va">od</span><span class="op">)</span></span>
<span><span class="co">#&gt; Percentage of gradient flow = 52.71</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="co">#&gt;        zone    potential</span></span>
<span><span class="co">#&gt; 1 E02000001 244.80671414</span></span>
<span><span class="co">#&gt; 2 E02000002  -1.22482197</span></span>
<span><span class="co">#&gt; 3 E02000003  -1.15462869</span></span>
<span><span class="co">#&gt; 4 E02000004  -1.23397762</span></span>
<span><span class="co">#&gt; 5 E02000005  -1.93591048</span></span>
<span><span class="co">#&gt; 6 E02000007   0.04170905</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-obtained-potential-landscape">Plot the obtained potential landscape<a class="anchor" aria-label="anchor" href="#plot-the-obtained-potential-landscape"></a>
</h2>
<p>The shapefile of the MSOAs is obtained from <a href="https://data.gov.uk/dataset/2cf1f346-2f74-4c06-bd4b-30d7e4df5ae7/middle-layer-super-output-area-msoa-boundaries" class="external-link">Office
for National Statistics</a>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.1, GDAL 3.6.3, PROJ 9.2.0; sf_use_s2() is TRUE</span></span>
<span><span class="va">shape</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"london.geojson"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Reading layer `MSOA_in_London' from data source </span></span>
<span><span class="co">#&gt;   `/home/aoki/Dropbox/00CurrentProject/HodgePotentialHumanFlow/vignettes/london.geojson' </span></span>
<span><span class="co">#&gt;   using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Simple feature collection with 983 features and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 503569.4 ymin: 155850.7 xmax: 561959.4 ymax: 200934.3</span></span>
<span><span class="co">#&gt; Projected CRS: OSGB36 / British National Grid</span></span>
<span><span class="va">merged</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">shape</span>, <span class="va">s</span>, all.x<span class="op">=</span><span class="cn">T</span>, by.x<span class="op">=</span><span class="st">"msoa11cd"</span>, by.y<span class="op">=</span><span class="st">"zone"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 530968.5 ymin: 180510.9 xmax: 551945.7 ymax: 191139.3</span></span>
<span><span class="co">#&gt; Projected CRS: OSGB36 / British National Grid</span></span>
<span><span class="co">#&gt;    msoa11cd objectid                 msoa11nm                msoa11nmw</span></span>
<span><span class="co">#&gt; 1 E02000001        1       City of London 001       City of London 001</span></span>
<span><span class="co">#&gt; 2 E02000002        2 Barking and Dagenham 001 Barking and Dagenham 001</span></span>
<span><span class="co">#&gt; 3 E02000003        3 Barking and Dagenham 002 Barking and Dagenham 002</span></span>
<span><span class="co">#&gt; 4 E02000004        4 Barking and Dagenham 003 Barking and Dagenham 003</span></span>
<span><span class="co">#&gt; 5 E02000005        5 Barking and Dagenham 004 Barking and Dagenham 004</span></span>
<span><span class="co">#&gt; 6 E02000007        6 Barking and Dagenham 006 Barking and Dagenham 006</span></span>
<span><span class="co">#&gt;   st_areashape st_lengthshape    potential                       geometry</span></span>
<span><span class="co">#&gt; 1      2897837       9297.742 244.80671414 MULTIPOLYGON (((532155.5 18...</span></span>
<span><span class="co">#&gt; 2      2161565       8307.072  -1.22482197 MULTIPOLYGON (((548879.6 19...</span></span>
<span><span class="co">#&gt; 3      2141516       9359.992  -1.15462869 MULTIPOLYGON (((548960.4 18...</span></span>
<span><span class="co">#&gt; 4      2492948       8476.617  -1.23397762 MULTIPOLYGON (((551551.9 18...</span></span>
<span><span class="co">#&gt; 5      1187953       7322.466  -1.93591048 MULTIPOLYGON (((549238.9 18...</span></span>
<span><span class="co">#&gt; 6      1735998       7071.096   0.04170905 MULTIPOLYGON (((549420.5 18...</span></span></code></pre></div>
<p>Plot the obtained potential landscape using <code>sf</code>
package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: viridisLite</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'scales'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:viridis':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     viridis_pal</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">merged</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">potential</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"viridis"</span>, trans<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/boxcox_trans.html" class="external-link">modulus_trans</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PotentialInLondon_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Takaaki Aoki.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
