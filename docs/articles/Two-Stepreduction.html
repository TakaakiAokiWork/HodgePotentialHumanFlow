<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Decouple the spatial and temporal components by PCA • HodgePotentialHumanFlow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decouple the spatial and temporal components by PCA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HodgePotentialHumanFlow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/PotentialInLondon.html">Potential of Human flow (complete graph case)</a></li>
    <li><a class="dropdown-item" href="../articles/PotentialInTokyo.html">Potential of Human flow (general graph case)</a></li>
    <li><a class="dropdown-item" href="../articles/Two-Stepreduction.html">Decouple the spatial and temporal components by PCA</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Decouple the spatial and temporal components by PCA</h1>
            
      

      <div class="d-none name"><code>Two-Stepreduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>This article explans the code for the subsequent principal component
analysis (PCA), proposed in Two-step dimensionality reduction of human
mobility data: From potential landscapes to spatiotemporal insights.</p>
<div class="section level3">
<h3 id="read-files-of-pontials-into-a-single-wide-dataframe">Read files of pontials into a single wide dataframe<a class="anchor" aria-label="anchor" href="#read-files-of-pontials-into-a-single-wide-dataframe"></a>
</h3>
<p>read each file and make a wide table</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_paths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"potential_2019_h.csv"</span>,</span>
<span>  <span class="st">"potential_2019_w.csv"</span>,</span>
<span>  <span class="st">"potential_2021_h.csv"</span>,</span>
<span>  <span class="st">"potential_2021_w.csv"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">preprocess</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#read the file</span></span>
<span>    <span class="va">potential</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="va">file_path</span>, col_types<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>zone<span class="op">=</span><span class="st">"c"</span>, org_hour<span class="op">=</span><span class="st">"i"</span>, dst_hour<span class="op">=</span><span class="st">"i"</span>, .default<span class="op">=</span><span class="st">"n"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#Add one column that is "weekday2019" or "weekday2021" or "weekday2021" or "holiday2021", depending on if "2019" or "2021" is in the file path, and if "weekday" or "holiday" is in the file path</span></span>
<span>    <span class="va">potential</span><span class="op">$</span><span class="va">day_type</span> <span class="op">&lt;-</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"2019"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_w"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2019w"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"2019"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_h"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2019h"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"2021"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_w"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2021w"</span>,  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"2021"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_h"</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2021h"</span>,</span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#combine day_type and org_hour into one column, like "weekday2019-01", with org_hour two digits</span></span>
<span>    <span class="va">potential</span><span class="op">$</span><span class="va">org_hour</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">potential</span><span class="op">$</span><span class="va">day_type</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="va">potential</span><span class="op">$</span><span class="va">org_hour</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#arange by org_hour, and select by zone, org_hour, potential</span></span>
<span>    <span class="va">potential</span> <span class="op">&lt;-</span> <span class="va">potential</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">org_hour</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">zone</span>, <span class="va">org_hour</span>, <span class="va">potential</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#make it a pivot table, where the columns are the zones, the rows are the org_hours, and the values are the potentials</span></span>
<span>    <span class="va">df_wider</span> <span class="op">&lt;-</span> <span class="va">potential</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">zone</span>, values_from <span class="op">=</span> <span class="va">potential</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#order by weekday2019-00 to weekday2019-23, then holiday2019-00 to holiday2019-23, then weekday2021-00 to weekday2021-23, then holiday2021-00 to holiday2021-23</span></span>
<span>    <span class="va">df_wider</span><span class="op">$</span><span class="va">org_hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df_wider</span><span class="op">$</span><span class="va">org_hour</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2019w-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2019h-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2021w-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"2021h-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df_wider</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># apply the function to all the files, and combine them into one dataframe</span></span>
<span><span class="va">df_wider_all</span> <span class="op">&lt;-</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="va">file_paths</span>, <span class="va">preprocess</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_wider_all</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 1,319</span></span></span>
<span><span class="co">#&gt;   org_hour `533903665` `533903865` `533904805` `533904825` `533904845`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019h-00     -<span style="color: #BB0000;">0.176</span>       0.096<span style="text-decoration: underline;">1</span>  -<span style="color: #BB0000;">0.229</span>       -<span style="color: #BB0000;">0.116</span>         0.191 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019h-01     -<span style="color: #BB0000;">0.053</span><span style="color: #BB0000; text-decoration: underline;">8</span>     -<span style="color: #BB0000;">0.063</span><span style="color: #BB0000; text-decoration: underline;">0</span>  -<span style="color: #BB0000;">0.163</span>        0.092<span style="text-decoration: underline;">5</span>        0.096<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019h-02     -<span style="color: #BB0000;">0.148</span>       0.119   -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">043</span><span style="color: #BB0000;">5</span>   -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">129</span>     -<span style="color: #BB0000;">0.046</span><span style="color: #BB0000; text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019h-03     -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">2</span>      0.108   -<span style="color: #BB0000;">0.126</span>       -<span style="color: #BB0000;">0.058</span><span style="color: #BB0000; text-decoration: underline;">2</span>       -<span style="color: #BB0000;">0.111</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019h-04     -<span style="color: #BB0000;">0.065</span><span style="color: #BB0000; text-decoration: underline;">5</span>      0.014<span style="text-decoration: underline;">1</span>  -<span style="color: #BB0000;">0.036</span><span style="color: #BB0000; text-decoration: underline;">7</span>       0.170         0.153 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019h-05      0.096<span style="text-decoration: underline;">0</span>     -<span style="color: #BB0000;">0.213</span>   -<span style="color: #BB0000;">0.462</span>       -<span style="color: #BB0000;">0.299</span>        -<span style="color: #BB0000;">0.206</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,313 more variables: `533904885` &lt;dbl&gt;, `533912065` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533912485` &lt;dbl&gt;, `533912685` &lt;dbl&gt;, `533913005` &lt;dbl&gt;, `533913065` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533913085` &lt;dbl&gt;, `533913205` &lt;dbl&gt;, `533913225` &lt;dbl&gt;, `533913245` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533913265` &lt;dbl&gt;, `533913405` &lt;dbl&gt;, `533913425` &lt;dbl&gt;, `533913445` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533913465` &lt;dbl&gt;, `533913485` &lt;dbl&gt;, `533913625` &lt;dbl&gt;, `533913645` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533913665` &lt;dbl&gt;, `533913685` &lt;dbl&gt;, `533913825` &lt;dbl&gt;, `533913845` &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   `533913865` &lt;dbl&gt;, `533913885` &lt;dbl&gt;, `533914005` &lt;dbl&gt;, …</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="make-it-into-a-matrix">Make it into a matrix<a class="anchor" aria-label="anchor" href="#make-it-into-a-matrix"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df_wider_all</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">org_hour</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="principle-component-analysis-pca">Principle Component Analysis (PCA)<a class="anchor" aria-label="anchor" href="#principle-component-analysis-pca"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">m</span>, center<span class="op">=</span><span class="cn">T</span>, scale<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scree-plot">Scree plot<a class="anchor" aria-label="anchor" href="#scree-plot"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcs</span> <span class="op">=</span> <span class="fu">tidy</span><span class="op">(</span><span class="va">result</span>, <span class="st">"pcs"</span><span class="op">)</span></span>
<span><span class="va">top3</span> <span class="op">&lt;-</span> <span class="va">pcs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">PC</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pcs</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">PC</span>, y<span class="op">=</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span><span class="fu">geom_col</span><span class="op">(</span>fill<span class="op">=</span><span class="st">"dodgerblue"</span>, alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span> <span class="st">"Variance explained"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">top3</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">PC</span>,</span>
<span>      y <span class="op">=</span> <span class="va">percent</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="va">PC</span>, <span class="st">": "</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Two-Stepreduction_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level2">
<h2 id="save-pca-rotation-basis">Save PCA rotation (basis)<a class="anchor" aria-label="anchor" href="#save-pca-rotation-basis"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rotation_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span></span>
<span><span class="va">rotation_df</span><span class="op">$</span><span class="va">MESH2KM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span></span>
<span><span class="va">rotation_df</span> <span class="op">=</span> <span class="va">rotation_df</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">MESH2KM</span>, <span class="va">PC1</span>,<span class="va">PC2</span>,<span class="va">PC3</span><span class="op">)</span></span>
<span><span class="co">#write_csv(rotation_df, "tmp/prc_basis.csv")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rotation_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;             MESH2KM          PC1           PC2          PC3</span></span>
<span><span class="co">#&gt; 533903665 533903665 -0.007638106  0.0081861818  0.022110372</span></span>
<span><span class="co">#&gt; 533903865 533903865 -0.008130319 -0.0092918304 -0.009184783</span></span>
<span><span class="co">#&gt; 533904805 533904805 -0.020939566  0.0048591637  0.025925711</span></span>
<span><span class="co">#&gt; 533904825 533904825 -0.010935582  0.0034375189  0.003985321</span></span>
<span><span class="co">#&gt; 533904845 533904845 -0.020297286  0.0047228773  0.010225484</span></span>
<span><span class="co">#&gt; 533904885 533904885 -0.030118096  0.0007656441  0.019902749</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-temporal-evolution-of-the-pc1-pc2-and-pc3">Plot temporal evolution of the PC1, PC2 and PC3<a class="anchor" aria-label="anchor" href="#plot-temporal-evolution-of-the-pc1-pc2-and-pc3"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">augmented_data</span> <span class="op">=</span> <span class="fu">augment</span><span class="op">(</span><span class="va">result</span>, data <span class="op">=</span> <span class="va">df_wider_all</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="co"># keep only the columns that start with a dot and also the org_hour column, rename the columns to remove the ".fitted" part</span></span>
<span><span class="va">augmented_data</span> <span class="op">=</span> <span class="va">augmented_data</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"."</span><span class="op">)</span>, <span class="va">org_hour</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rename_all</span><span class="op">(</span><span class="op">~</span><span class="fu">str_remove</span><span class="op">(</span><span class="va">.</span>, <span class="st">"\\.fitted"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># split the org_hour column into two columns, one for the day type and one for the hour</span></span>
<span><span class="va">augmented_data</span> <span class="op">=</span> <span class="va">augmented_data</span> <span class="op">%&gt;%</span> <span class="fu">separate</span><span class="op">(</span><span class="va">org_hour</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"day_type"</span>, <span class="st">"hour"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"-"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">relocate</span><span class="op">(</span><span class="va">day_type</span>, <span class="va">hour</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">.rownames</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">augmented_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 98</span></span></span>
<span><span class="co">#&gt;   day_type hour     PC1     PC2    PC3     PC4    PC5    PC6   PC7    PC8</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019h    00    -<span style="color: #BB0000;">8.78</span>  -<span style="color: #BB0000;">7.10</span>   -<span style="color: #BB0000;">0.613</span> -<span style="color: #BB0000;">3.43</span>    1.28  -<span style="color: #BB0000;">0.506</span> 1.20  2.93  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019h    01    -<span style="color: #BB0000;">2.11</span>  -<span style="color: #BB0000;">4.24</span>   -<span style="color: #BB0000;">1.32</span>  -<span style="color: #BB0000;">2.45</span>    0.478  0.728 1.37  1.88  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019h    02    -<span style="color: #BB0000;">0.508</span> -<span style="color: #BB0000;">2.28</span>   -<span style="color: #BB0000;">1.38</span>  -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">0.319</span>  0.500 1.09  1.52  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019h    03     0.290 -<span style="color: #BB0000;">1.53</span>   -<span style="color: #BB0000;">1.02</span>  -<span style="color: #BB0000;">1.24</span>   -<span style="color: #BB0000;">0.905</span>  0.378 0.838 1.13  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019h    04     2.02   0.086<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.984</span> -<span style="color: #BB0000;">0.628</span>  -<span style="color: #BB0000;">2.12</span>   0.405 0.574 0.609 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019h    05    12.6    3.62   -<span style="color: #BB0000;">3.46</span>  -<span style="color: #BB0000;">0.085</span><span style="color: #BB0000; text-decoration: underline;">3</span> -<span style="color: #BB0000;">1.97</span>   1.00  0.272 0.086<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 88 more variables: PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC19 &lt;dbl&gt;, PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC31 &lt;dbl&gt;, PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;, PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC37 &lt;dbl&gt;, PC38 &lt;dbl&gt;, PC39 &lt;dbl&gt;, PC40 &lt;dbl&gt;, PC41 &lt;dbl&gt;, PC42 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC43 &lt;dbl&gt;, PC44 &lt;dbl&gt;, PC45 &lt;dbl&gt;, PC46 &lt;dbl&gt;, PC47 &lt;dbl&gt;, PC48 &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>pickup weekdau in 2019</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filtered_data</span> <span class="op">&lt;-</span> <span class="va">augmented_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">day_type</span> <span class="op">==</span> <span class="st">"2019w"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">filtered_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 98</span></span></span>
<span><span class="co">#&gt;   day_type hour     PC1    PC2    PC3    PC4    PC5    PC6     PC7   PC8     PC9</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019w    00    -<span style="color: #BB0000;">6.61</span>  -<span style="color: #BB0000;">3.28</span>  -<span style="color: #BB0000;">1.20</span>  -<span style="color: #BB0000;">2.74</span>  -<span style="color: #BB0000;">0.805</span>  1.21  -<span style="color: #BB0000;">0.010</span><span style="color: #BB0000; text-decoration: underline;">4</span> 0.665 -<span style="color: #BB0000;">0.036</span><span style="color: #BB0000; text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019w    01    -<span style="color: #BB0000;">2.04</span>  -<span style="color: #BB0000;">1.76</span>  -<span style="color: #BB0000;">1.62</span>  -<span style="color: #BB0000;">2.10</span>  -<span style="color: #BB0000;">1.24</span>   1.55   0.702  0.161 -<span style="color: #BB0000;">0.246</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019w    02    -<span style="color: #BB0000;">0.458</span> -<span style="color: #BB0000;">0.762</span> -<span style="color: #BB0000;">1.35</span>  -<span style="color: #BB0000;">1.17</span>  -<span style="color: #BB0000;">1.28</span>   0.797  0.472  0.154 -<span style="color: #BB0000;">0.017</span><span style="color: #BB0000; text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019w    03     0.466 -<span style="color: #BB0000;">0.265</span> -<span style="color: #BB0000;">0.898</span> -<span style="color: #BB0000;">0.968</span> -<span style="color: #BB0000;">1.44</span>   0.431  0.439  0.202  0.056<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019w    04     2.99   1.09  -<span style="color: #BB0000;">1.14</span>   0.239 -<span style="color: #BB0000;">2.55</span>  -<span style="color: #BB0000;">0.350</span>  0.813  0.153 -<span style="color: #BB0000;">0.222</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019w    05    23.5    6.80  -<span style="color: #BB0000;">8.44</span>   2.70  -<span style="color: #BB0000;">5.56</span>  -<span style="color: #BB0000;">2.01</span>   4.10   0.654 -<span style="color: #BB0000;">0.551</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 87 more variables: PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;, PC13 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;, PC19 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;, PC25 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;, PC31 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;, PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;, PC37 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC38 &lt;dbl&gt;, PC39 &lt;dbl&gt;, PC40 &lt;dbl&gt;, PC41 &lt;dbl&gt;, PC42 &lt;dbl&gt;, PC43 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   PC44 &lt;dbl&gt;, PC45 &lt;dbl&gt;, PC46 &lt;dbl&gt;, PC47 &lt;dbl&gt;, PC48 &lt;dbl&gt;, PC49 &lt;dbl&gt;, …</span></span></span></code></pre></div>
<p>pc1 vs pc2</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">filtered_data</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">PC1</span>, <span class="op">-</span><span class="va">PC2</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#PC2 flipped</span></span>
<span>            <span class="fu">geom_path</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">day_type</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Lines based on hour</span></span>
<span>            <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Points also based on hour</span></span>
<span>            <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">hour</span><span class="op">)</span>, min.segment.length <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Point labels</span></span>
<span>            <span class="fu">scale_color_gradientn</span><span class="op">(</span></span>
<span>                colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>,  <span class="co"># Custom gradient from night to day</span></span>
<span>                values <span class="op">=</span> <span class="fu">rescale</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">23</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Map 0-6 (night) and 18-24 (day) with corresponding colors</span></span>
<span>                name <span class="op">=</span> <span class="st">"Hour"</span></span>
<span>            <span class="op">)</span> <span class="op">+</span>  </span>
<span>            <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,  <span class="co"># Move legend to the right</span></span>
<span>                legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,  <span class="co"># Ensure vertical arrangement of legend</span></span>
<span>                legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>r <span class="op">=</span> <span class="fl">50</span>, b <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="op">)</span> <span class="op">+</span>  </span>
<span>                <span class="fu">guides</span><span class="op">(</span></span>
<span>                    color <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span></span>
<span>                    barwidth <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                    barheight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    title.position <span class="op">=</span> <span class="st">"left"</span>,  <span class="co"># Move the title to the left of the colorbar</span></span>
<span>                    title.hjust <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Center the title vertically relative to the colorbar</span></span>
<span>                    label.vjust <span class="op">=</span> <span class="fl">0.5</span>   <span class="co"># Vertically align the labels</span></span>
<span>                    <span class="op">)</span></span>
<span>                <span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: ggrepel: 7 unlabeled data points (too many overlaps). Consider</span></span>
<span><span class="co">#&gt; increasing max.overlaps</span></span></code></pre></div>
<p><img src="Two-Stepreduction_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pc1 vs pc3</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">filtered_data</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC3</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">#PC2 flipped</span></span>
<span>            <span class="fu">geom_path</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">day_type</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Lines based on hour</span></span>
<span>            <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Points also based on hour</span></span>
<span>            <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">hour</span><span class="op">)</span>, min.segment.length <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Point labels</span></span>
<span>            <span class="fu">scale_color_gradientn</span><span class="op">(</span></span>
<span>                colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>,  <span class="co"># Custom gradient from night to day</span></span>
<span>                values <span class="op">=</span> <span class="fu">rescale</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">23</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Map 0-6 (night) and 18-24 (day) with corresponding colors</span></span>
<span>                name <span class="op">=</span> <span class="st">"Hour"</span></span>
<span>            <span class="op">)</span> <span class="op">+</span>  </span>
<span>            <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,  <span class="co"># Move legend to the right</span></span>
<span>                legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,  <span class="co"># Ensure vertical arrangement of legend</span></span>
<span>                legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, margin <span class="op">=</span> <span class="fu">margin</span><span class="op">(</span>r <span class="op">=</span> <span class="fl">50</span>, b <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="op">)</span> <span class="op">+</span>  </span>
<span>                <span class="fu">guides</span><span class="op">(</span></span>
<span>                    color <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span></span>
<span>                    barwidth <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                    barheight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    title.position <span class="op">=</span> <span class="st">"left"</span>,  <span class="co"># Move the title to the left of the colorbar</span></span>
<span>                    title.hjust <span class="op">=</span> <span class="fl">0.5</span>,  <span class="co"># Center the title vertically relative to the colorbar</span></span>
<span>                    label.vjust <span class="op">=</span> <span class="fl">0.5</span>   <span class="co"># Vertically align the labels</span></span>
<span>                    <span class="op">)</span></span>
<span>                <span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"PC1"</span>, y <span class="op">=</span> <span class="st">"PC3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: ggrepel: 6 unlabeled data points (too many overlaps). Consider</span></span>
<span><span class="co">#&gt; increasing max.overlaps</span></span></code></pre></div>
<p><img src="Two-Stepreduction_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Takaaki Aoki.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
